ARG CUDA_VER=12.2.2
ARG UBUNTU_VER=22.04

FROM nvidia/cuda:${CUDA_VER}-cudnn8-runtime-ubuntu${UBUNTU_VER}

ARG PYTHON_VER=3.10
ARG DEBIAN_FRONTEND="noninteractive"

RUN apt-get update && apt-get install -y --no-install-recommends \
    nvidia-container-toolkit-base \
    bash \
    bash-completion \
    ca-certificates \
    curl \
    git \
    htop \
    nano \
    nvidia-modprobe \
    openssh-client \
    python${PYTHON_VER} python${PYTHON_VER}-dev python3-pip python-is-python3 \
    sudo \
    tmux \
    unzip \
    vim \
    wget \
    zip

RUN pip install --upgrade --no-cache-dir pip setuptools wheel && \
    pip install --upgrade --no-cache-dir \
    ipywidgets \
    jupyterlab \
    notebook \
    matplotlib==3.7.5 \
    tikzplotlib==0.10.1 \
    numpy \
    pandas \
    scipy \
    scikit-image \
    scikit-learn \
    seaborn \
    tabulate \
    tqdm \
    librosa \
    arch \
    sympy

ARG MY_USER
ARG MY_UID
ARG MY_GID

RUN if [ -n "${MY_USER}" ]; then \
        groupadd -g ${MY_GID} ${MY_USER} && \
        useradd -m -u ${MY_UID} -g ${MY_GID} -s /bin/bash ${MY_USER} && \
        echo "${MY_USER} ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers ; \
    fi